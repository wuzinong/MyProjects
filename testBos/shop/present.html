<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>打赏管理</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../public/admin/plugins/Hplus-v.4.1.0/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link rel="stylesheet" href="../public/admin/plugins/iconfont/iconfont.css">

    <link href="../public/admin/plugins/Hplus-v.4.1.0/css/plugins/bootstrap-table/bootstrap-table.min.css"
          rel="stylesheet">
    <link rel="stylesheet" href="../public/admin/plugins/bootstrap3-editable/css/bootstrap-editable.css">

    <link rel="stylesheet" href="../public/admin/css/p-waiter.css?rev=@@hash">
</head>
<body class="gray-bg">
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-9">
        <h2>打赏管理
            <small class="g-fs--12 text-muted"></small>
        </h2>
        <!--<ol class="breadcrumb">
            <li>
                <a href="index.html">主页</a>
            </li>
            <li class="active">
                <strong>打赏明细</strong>
            </li>
        </ol>-->
    </div>
</div>
<div class="wrapper wrapper-content">

    <!--打赏数据图表 end-->
    <div class="row">
        
        <div class="col-md-12">
            <!--礼物设置 start-->
            <div class="ibox">
                <div class="ibox-title">
                    <h5>礼物设置</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="iconfont icon-packup"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content m-ibox-overflow-y">
                    <div class="m-overflow_inner" style="height: 468px;padding-bottom:50px;">
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>打赏类型</th>
                                <th>图片</th>
                                <th>价格（元）</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php if (!empty($presentList)):foreach ($presentList as $present): ?>
                                <tr data-presentId="<?php echo $present['present_id'] ?>">
                                    <td><?php echo $present['name'] ?></td>
                                    <td>
                                        <div class="m-avatar m-avatar-sm g-ml--5">
                                            <img class="img-rounded"
                                                 src="<?php echo image_processor($present['picture']) ?>" alt="">
                                        </div>
                                    </td>
                                    <td>
                                        <?php echo $present['money'] ?>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary btn-sm dropdown-toggle"
                                                    data-toggle="dropdown">操作<span class="caret"></span></button>
                                            <ul class="dropdown-menu">
                                                <li><a class="js-gift-site" href="javascript:;">修改</a></li>
                                                <li><a class="js-gift-del" href="javascript:;">删除</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            <?php endforeach;endif; ?>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="ibox-footer g-ta--r">
                    <button type="button" class="btn btn-primary js-gift-add">新增礼物</button>
                </div>
            </div>
            <!--礼物设置 end-->
        </div>
    </div>
</div>
<!--弹出层-->
<!--礼物设置-->
<div id="gift-site" class="modal fade">
    <form action="">
        <div class="modal-dialog">
            <div class="modal-content form-horizontal animated flipInY">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">礼物设置</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <input type="hidden" name="" id="js-presentid">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">礼物</label>
                                <div class="col-sm-8">
                                    <!--新增工号是自动生成的-->
                                    <select id="js-name" name="" class="form-control">
                                        <option selected value="钞票">钞票</option>
                                        <option value="小星星">小星星</option>
                                        <option value=520>520</option>
                                        <option value=么么哒>么么哒</option>
                                        <option value=棒棒哒>棒棒哒</option>
                                        <option value=666>666</option>
                                        <option value=亲亲鱼>亲亲鱼</option>
                                        <option value=萌萌兔>萌萌兔</option>
                                        <option value=爱心气球>爱心气球</option>
                                        <option value=浪漫樱花>浪漫樱花</option>
                                        <option value=棒棒糖>棒棒糖</option>
                                        <option value=礼帽>礼帽</option>
                                        <option value=告白公仔>告白公仔</option>
                                        <option value=梦幻纸鹤>梦幻纸鹤</option>
                                        <option value=惊喜彩蛋>惊喜彩蛋</option>
                                        <option value=生日蛋糕>生日蛋糕</option>
                                        <option value=浪漫烟花>浪漫烟花</option>
                                        <option value=金话筒>金话筒</option>
                                        <option value=假面舞会>假面舞会</option>
                                        <option value=守护白马>守护白马</option>
                                        <option value=水晶鞋>水晶鞋</option>
                                        <option value=爱疯X>爱疯X</option>
                                        <option value=钻戒>钻戒</option>
                                        <option value=生日Party>生日Party</option>
                                        <option value=直冲云霄>直冲云霄</option>
                                        <option value=跑车>跑车</option>
                                        <option value=兰博基尼>兰博基尼</option>
                                        <option value=保时捷>保时捷</option>
                                        <option value=玛莎拉蒂>玛莎拉蒂</option>
                                        <option value=飞机>飞机</option>
                                        <option value=海上城市>海上城市</option>
                                        <option value=豪华游轮>豪华游轮</option>
                                        <option value=梦幻城堡>梦幻城堡</option>
                                        <option value=差评>差评</option>
                                        <option value=一般>一般</option>
                                        <option value=满意>满意</option>
                                        <option value=优秀>优秀</option>
                                        <option value=极好>极好</option>
                                        <option value=赏>赏</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label">图片</label>
                                <div class="col-sm-8">
                                    <div class="m-avatar m-avatar-sm g-ml--5">
                                        <img id="js-picture" class="img-rounded"
                                             src="http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/000.png" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">价格</label>
                                <div class="col-sm-8">
                                    <input id="js-money" type="number" class="form-control" placeholder="请设置金额">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button id="js-addPresent" type="button" class="btn btn-primary js-btn-present">保存</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- 全局js -->
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/jquery.min.js?v=2.1.4"></script>
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/bootstrap.min.js?v=3.3.6"></script>


<!--ECharts-->
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/plugins/echarts/echarts.js?v=3.6"></script>

<!-- 自定义js -->
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/content.js?v=1.0.0"></script>

<!-- GITTER -->
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/plugins/gritter/jquery.gritter.min.js"></script>

<!-- Bootstrap table -->
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="../public/admin/plugins/Hplus-v.4.1.0/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

<script src="../public/admin/plugins/bootstrap3-editable/js/bootstrap-editable.min.js"></script>

<!--bootstrap dropdown-->
<script src="../public/admin/plugins/bootstrap/js/bootstrap-hover-dropdown.min.js"></script>

<!-- layerDate plugin javascript -->
<script src="../public/admin/plugins/laydate/laydate.js"></script>
<script src="../public/admin/plugins/layer/layer.js"></script>

<script src="../public/admin/js/m-ibox.js?ver=1004"></script>
<script>
    $(function () {
        /*时间选择*/
        //日期范围
        laydate.render({
            elem: '#js-date-reward-total'
            , range: true
            ,done: function(value, date, endDate){
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                var href_date='/shopAdmin/reward?start_date='+value+'&end_date='+endDate;
                window.location.href=href_date;
            }
        });

        /*添加礼物*/
        $(".modal").on('change', '#js-name', function () {
            var $val = $(this).val();
            console.log($val);
            if ($val == '钞票') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/000.png');
            }
            if ($val == '小星星') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/001xiaoxingxing.png');
            }
            if ($val == '520') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/002woaixin.png');
            }
            if ($val == '么么哒') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/003memeda.png');
            }
            if ($val == '棒棒哒') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/004bangbangda.png');
            }
            if ($val == '666') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/005liuliuliu.png');
            }
            if ($val == '亲亲鱼') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/006qinqinyu.png');
            }
            if ($val == '萌萌兔') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/007mengmengtu.png');
            }
            if ($val == '爱心气球') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/008aixinqiqiu.png');
            }
            if ($val == '浪漫樱花') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/009langmanyinghua.png');
            }
            if ($val == '棒棒糖') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/010bangbangtang.png');
            }
            if ($val == '礼帽') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/011limao.png');
            }
            if ($val == '告白公仔') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/012gaobaigongzai.png');
            }
            if ($val == '梦幻纸鹤') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/013menghuanzhihe.png');
            }
            if ($val == '惊喜彩蛋') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/014jingxicaidan.png');
            }
            if ($val == '生日蛋糕') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/015shengridangao.png');
            }
            if ($val == '浪漫烟花') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/016lianaiyanhua.png');
            }
            if ($val == '金话筒') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/017jinhuatong.png');
            }
            if ($val == '假面舞会') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/018jiamianwuhui.png');
            }
            if ($val == '守护白马') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/019shouhubaima.png');
            }
            if ($val == '水晶鞋') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/020shuijingxie.png');
            }
            if ($val == '爱疯X') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/021iphoneX.png');
            }
            if ($val == '钻戒') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/022zuanjie.png');
            }
            if ($val == '生日Party') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/023shengriparty.png');
            }
            if ($val == '直冲云霄') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/024zhichongyunxiao.png');
            }
            if ($val == '跑车') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/025paoche.png');
            }
            if ($val == '兰博基尼') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/026lanbojini.png');
            }
            if ($val == '保时捷') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/027baoshijie.png');
            }
            if ($val == '玛莎拉蒂') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/028mashaladi.png');
            }
            if ($val == '飞机') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/029feiji.png');
            }
            if ($val == '海上城市') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/030haishangshuicheng.png');
            }
            if ($val == '豪华游轮') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/031haohuayoulun.png');
            }
            if ($val == '梦幻城堡') {
                $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/032menghuanchengbao.png');
            }
            if($val=='差评'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/033chaping.png');
            }
            if($val=='一般'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/034yiban.png');
            }
            if($val=='满意'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/035manyi.png');
            }
            if($val=='优秀'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/036youxiu.png');
            }
            if($val=='极好'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/037jihao.png');
            }
            if($val=='赏'){
                $("#js-picture").attr('src','http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/038shang.png');
            }
        });
        $('.js-gift-add').on('click', function () {
            $("#js-name  option[value='钞票']").attr("selected", true);
            $("#js-picture").attr('src', 'http://bossshangba.oss-cn-hangzhou.aliyuncs.com/reward/000.png');
            $("#js-money").val('');
            $(".js-btn-present").attr('id', 'js-addPresent');
        });
        $("body").on('click', '#js-addPresent', function () {
            var name = $("#js-name").val();
            var picture = $("#js-picture").attr('src');
            var money = $("#js-money").val();
            /*console.log(name);
            console.log(picture);
            console.log(money);*/
            if (!name == '' && !picture == '' && !money == '') {
                $.ajax({
                    type: 'POST',
                    url: '/shopAdmin/reward/addPresent',
                    dataType: 'json',
                    data: {
                        name: name,
                        picture: picture,
                        money: money,
                    },
                    success: function (data) {
                        if (data.code === 200) {
                            $("#gift-site").modal('hide');
                            layer.msg('添加成功', {
                                anim: 0,
                                time: 1000
                            }, function () {
                                window.location.reload(true);
                            });
                        } else if (data.code === 400) {
                            layer.msg(data.message);
                        }
                    },
                    error: function (jqXHR) {
                        console.log("发生错误" + jqXHR.status);
                    }
                });
            } else {
                layer.msg('请正确填选选项');
            }

        });
        /*修改礼物*/
        $(".table").on('click', '.js-gift-site', function () {
            var $this_tr = $(this).closest('tr');
            var old_name = $this_tr.find('td:eq(0)').text();
            var old_picture = $this_tr.find('td:eq(1) img').attr('src');
            var old_money = $.trim($this_tr.find('td:eq(2)').text());
            var present_id = $(this).closest('tr').attr('data-presentId');
//        console.log(old_money);
            $("#js-name  option[value='" + old_name + "']").attr("selected", true);
            $("#js-picture").attr('src', old_picture);
            $("#js-money").val(old_money);
            $("#js-presentid").val(present_id);
            $(".js-btn-present").attr('id', 'js-setPresent');
        });
        $("body").on('click', '#js-setPresent', function () {
            var present_id = $("#js-presentid").val();
            var name = $("#js-name").val();
            var picture = $("#js-picture").attr('src');
            var money = $("#js-money").val();

            if (!name == '' && !picture == '' && !money == '') {
//            console.log('ajax');
                $.ajax({
                    type: 'POST',
                    url: '/shopAdmin/reward/updatePresent',
                    dataType: 'json',
                    data: {
                        present_id: present_id,
                        name: name,
                        picture: picture,
                        money: money,
                    },
                    success: function (data) {
                        if (data.code === 200) {
                            $("#gift-site").modal('hide');
                            layer.msg('修改成功', {
                                anim: 0,
                                time: 1000
                            }, function () {
                                window.location.reload(true);
                            });
                        } else if (dat.code === 400) {
                            layer.msg(data.message);
                        }
                    },
                    error: function (jqXHR) {
                        console.log("发生错误" + jqXHR.status);
                    }
                });
            }
        });
        /*删除礼物*/
        $('.table').on('click', '.js-gift-del', function () {
            var $this_tr = $(this).closest("tr");
            var present_id = $this_tr.attr('data-presentid');

            layer.confirm('确定要删除这个礼物吗？', {icon: 3}, function (index) {
                //删除tr
                $.ajax({
                    type: 'POST',
                    url: '/shopAdmin/reward/deletePresent',
                    dataType: 'json',
                    data: {
                        present_id: present_id,
                    },
                    success: function (data) {
                        if (data.code === 200) {
                            $this_tr.remove();
                            layer.close(index, {
                                time: 1000
                            });
                            layer.msg('删除成功');
                        } else if (data.code === 400) {
                            layer.msg(data.message);
                        }
                    },
                    error: function (jqXHR) {
                        console.log("发生错误" + jqXHR.status);
                    }
                });

            });

        });
    });
</script>
</body>
</html>